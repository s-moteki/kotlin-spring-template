# kotlin-spring-template  

ãƒ»æœ€è¿‘ãƒãƒã£ã¦ã„ã‚‹ Kotlin+SpringBoot ã®çµ„ã¿åˆã‚ã›ã®ã€ã‚ã‚‰ã‹ã˜ã‚è‡ªåˆ†å¥½ã¿ã«è¨­å®šã—ãŸã©ã®ç’°å¢ƒã§ã‚‚ã™ãã«å‹•ä½œã•ã›ã‚‰ã‚Œã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã™ã€‚(Dockerã€AWSæƒ³å®š)  

## ä½¿ç”¨æŠ€è¡“ã€ãƒ„ãƒ¼ãƒ«ã€ç’°å¢ƒ

| é …ç›® | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” | å¿…é ˆ | å‚™è€ƒ |
|:-----------:|:-----------:|:-----------:|:-----------:|:-----------:|
| JDK | 1.8 | è¨€èª | â—‹ |  |
| Kotlint | 1.3.72 | è¨€èª | â—‹ |  |
| Gradle | 6.3 | ä¾å­˜é–¢ä¿‚ | â—‹ | kotlin-dsl |
| Spring Boot | 2.2.6 | ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | â—‹ | |
| MySQL | 8.0 | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ | â—‹ |  |
| nginx | 1.17.2 | ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚· | â–³ |  |
| Docker | æŒ‡å®šãªã— | ä»®æƒ³ã‚³ãƒ³ãƒ†ãƒŠ | â—‹ |  |
| docker-compose | æŒ‡å®šãªã— | ãƒãƒ«ãƒã‚³ãƒ³ãƒ†ãƒŠ | â—‹ |  |
| InteliJ IDEA | æŒ‡å®šãªã— | IDE | Ã— | åŸºæœ¬ãªã‚“ã§ã‚‚ğŸ™†â€â™‚ï¸ |
| Git | æŒ‡å®šãªã— | ã‚½ãƒ¼ã‚¹ç®¡ç† | Ã— | |  

â€» Dockerã‚’ä½¿ç”¨ã—ãªã„å ´åˆã¯JDKã€MySQLã€nginxã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒåˆ¥é€”å¿…è¦ã§ã™ã€‚

## ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒª  

| é …ç›® | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |  å‚™è€ƒ |
|:-----------:|:-----------:|:-----------:|:-----------:|
| JPA | 2.3.0 | ORãƒãƒƒãƒ‘ãƒ¼ | |
| jpamodelgen | 5.4.15 | ãƒ¡ã‚¿ãƒ¢ãƒ‡ãƒ« | ã‚¿ã‚¤ãƒ—ã‚»ãƒ¼ãƒ• |
| thymeleaf | 3 | ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ | |
| Flyway | 5.2.3 | ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ |  |
| H2 | 1.4.191 | ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªDB | CI/CDç”¨ |

## CI/CDæ§‹æˆ  

### ECSã®ãƒ‡ãƒ—ãƒ­ã‚¤  

buildspecã‚’ãã‚Œãã‚Œã®ç’°å¢ƒã«é©ã—ãŸè¨­å®šã§ä¿®æ­£ã—ã€AWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰è¨­å®šãŒå¿…è¦ã€‚  
å‚è€ƒ â†’ [AWSå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://aws.amazon.com/jp/premiumsupport/knowledge-center/codepipeline-github-enterprise-ecs-app/ "AWS")  

![ESCæ§‹æˆå›³](./doc/codepipeline-ecs.png)

### ERå›³ã®ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°

buildspecã‚’ãã‚Œãã‚Œã®ç’°å¢ƒã«é©ã—ãŸè¨­å®šã§ä¿®æ­£ã—ã€Code Buildä¸Šã§SchemaSpyã‚’å®Ÿè¡Œã€‚(AWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§è¨­å®šã‚’ã™ã‚‹)  
ç”Ÿæˆã•ã‚ŒãŸHTMLã‚’ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã¨ã—ã¦S3ã«å‡ºåŠ›ã—ã€ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹ã€‚

![ESCæ§‹æˆå›³](./doc/schema-spy.png)

## ç’°å¢ƒæ§‹ç¯‰æ‰‹é †  

1.ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³
> git clone git@github.com:s-moteki/kotlin-spring-template.git

2.ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ç§»å‹•
> cd kotlin-spring-template

3.DBã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•
> docker-compose up -d --build sample_db

4.ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ“ãƒ«ãƒ‰  
> ./gradlew clean build  

5.ã‚³ãƒ³ãƒ†ãƒŠå…¨ä½“ã‚’èµ·å‹•  
> docker-compose up --build  

â€»æ¬¡å›ä»¥é™æ‰‹é †2ã€5ã§èµ·å‹•

### èµ·å‹•å¾Œã‚¤ãƒ¡ãƒ¼ã‚¸
![ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸](./doc/container.png)
